---
title: "DATA607 Assignment 2"
author: "Lucas Weyrich"
date: "2024-02-02"
output:
  html_document:
    df_print: paged
---
This assignment requires to survey five friends about six movies, and their rating on a scale of 1 to 5. The assingment also requires to utilize SQL databases
Below I am recording the answers in a dataframe called answers
```{r setup, include=FALSE}
answers = data.frame(
  ID = c(1, 2, 3, 4, 5),
  Wolf_of_Wallstreet = c(3, 4, 4, 1, 2),
  Miracle_in_Cell_7 = c(5, 3, NA, 4, 4),
  The_Revenant = c(4, 5, 3, NA, 4),
  Barbie = c(3, 2, 4, 5, 4),
  Oppenheimer = c(4, 3, 5, 1, 3),
  Napoleon = c(NA, 4, 2, NA, 4)
)
```

I don't have much SQL experience besides working with Access databases in R, but I know that SQLite has also good R compatibility. So I decided to import my dataframe via R into an SQL database, and then call it again as demonstration.

```{r}
library(DBI)
library(RSQLite)

con = dbConnect(SQLite(), dbname = 'movie_survey.db')
dbWriteTable(con, 'movie_survey', answers, overwrite = TRUE)
dbDisconnect(con)
```
Here I have established a connection to a new datbase, created a database in SQLite and uploaded my dataframe. I will now connect again and import the dataframe into R as sql_df

```{r}
library(RSQLite)
con2 = dbConnect(SQLite(), dbname = 'movie_survey.db')
sql_df = dbReadTable(con2, 'movie_survey')
head(sql_df)
```
head() shows that the dataframe was successfully re-imported into R, and it can  be used and manipulated. 
There are some missing values, so complete data analysis is not possible. There are several ways how these could be handled. 
(1) They could be simply ignored and used as-is, however, this can lead to imbalanced data that can skew results in analysis.
(2) The mean of all within subject observations could be computed and used to replace the missing value, however, since the movies are different genres, it is really only a band-aid.
(3) If more data was available, one could use algorithms to predict the missing value based on the existing data, with high confidence.

Since there is not much data, I will use the mean of the within-subject observations to replace the missing value.

```{r}
library(dplyr)
sql_df2 = sql_df %>%
  mutate(across(where(is.numeric), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))
```
Now the missing values are handled, more or less. To get a quick idea of the data, summary() shows key descriptive stats

```{r}
summary(sql_df2)
```

As summary() shows, the highest mean rating is a tie between Miracle in Cell 7 and The Revenant with 4, while the lowest mean rating is tied for Oppenheimer and The Wolf of Wallstreet. It would have been cool to ask some additional questions about what makes people rate a movie in a specific way.