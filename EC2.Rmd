---
title: "DATA607 EC"
author: "Lucas Weyrich"
date: "2024-03-09"
output: html_document
---
This extra credit assignment is to practice window functions. As an example, I am using stock time series from the stocks for SAP, Volkswagen, and Berkshire Hathaway (B-stock)
These data were download easily from Yahoo Finance as csv. 

```{r Import}
library(tidyverse)
library(dplyr)
library(ggplot2)

sap = read.csv('https://raw.githubusercontent.com/lucasweyrich958/DATA607/main/SAP.DE.csv')
vw = read.csv('https://raw.githubusercontent.com/lucasweyrich958/DATA607/main/VOW.DE-2.csv')
brk = read.csv('https://raw.githubusercontent.com/lucasweyrich958/DATA607/main/BRK-B.csv')

count(sap)
count(vw)
count(brk)
```
Firstly, after importing all three data frames, isn't it interesting how there have been a few more trading days for the two German stocks, SAP and VW, than for the US Berkshire? I would have expected the opposite, actually.
Quickly looking at the time series of all three below.

```{r}
sap$Date = as.Date(sap$Date)
vw$Date = as.Date(vw$Date)
brk$Date = as.Date(brk$Date)

ggplot() +
  geom_line(data = sap, aes(y = Close, x = Date, color = "SAP")) +
  geom_line(data = vw, aes(y = Close, x = Date, color = "VW")) +
  geom_line(data = brk, aes(y = Close, x = Date, color = "BRK")) +
  labs(title = "SAP, VW, Berkshire Prices Over Time",
       x = "Date",
       y = "Closing Price (EUR, USD)",
       color = "Stocks") +
  scale_color_manual(values = c("SAP" = "#19747E", "VW" = "#0077B6", "BRK" = "#3D405B")) +
  theme_minimal() +
  theme(legend.position = "bottom") +  # Move legend to the bottom
  guides(color = guide_legend(title = NULL, keywidth = 2, keyheight = 2, default.unit = "cm"))  
```
Below, the code is using a window function to calculate the year-to-date average and the six-day moving averages for each item.

```{r}
vw %>%
  filter(Date > "2024-01-02") %>%
  mutate(ytd_avg = cummean(Close))
sap %>%
  filter(Date > "2024-01-02") %>%
  mutate(ytd_avg = cummean(Close))
brk %>%
  filter(Date > "2024-01-02") %>%
  mutate(ytd_avg = cummean(Close))

library(zoo)
vw_rollavg = vw %>%
  mutate(roll_avg = rollmean(Close, k = 6, fill = NA, align = 'right'))
sap_rollavg = sap %>%
  mutate(roll_avg = rollmean(Close, k = 6, fill = NA, align = 'right'))
brk_rollavg = brk %>%
  mutate(roll_avg = rollmean(Close, k = 6, fill = NA, align = 'right'))
vw_rollavg
sap_rollavg
brk_rollavg
```


